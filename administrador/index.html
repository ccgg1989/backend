<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation Menu -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Product Manager</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" href="#home" onclick="showSection('home')">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#create" data-bs-toggle="modal" data-bs-target="#createProductModal">Crear Productos</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Sections -->
    <div class="container mt-4">
        <!-- Home Section -->
        <div id="home">
            <h1>Lista de Productos</h1>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Precio</th>
                        <th>Descuento</th>
                        <th>Proveedor</th>
                        <th>Stock</th>
                        <th>Imagen</th>
                        <th>Etiquetas</th>
                    </tr>
                </thead>
                <tbody id="productTableBody">
                    <!-- Productos cargados dinámicamente -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Crear Producto Modal -->
    <div class="modal fade" id="createProductModal" tabindex="-1" aria-labelledby="createProductModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createProductModalLabel">Crear Producto</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="createProductForm">
                        <div class="mb-3">
                            <label for="nameproducts" class="form-label">Nombre del Producto</label>
                            <input type="text" class="form-control" id="nameproducts" required>
                        </div>
                        <div class="mb-3">
                            <label for="descriptions" class="form-label">Descripción</label>
                            <textarea class="form-control" id="descriptions" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="price" class="form-label">Precio</label>
                            <input type="number" class="form-control" id="price" required>
                        </div>
                        <div class="mb-3">
                            <label for="discount" class="form-label">Descuento (%)</label>
                            <input type="number" class="form-control" id="discount">
                        </div>
                        <div class="mb-3">
                            <label for="provider" class="form-label">Proveedor</label>
                            <input type="text" class="form-control" id="provider" required>
                        </div>
                        <div class="mb-3">
                            <label for="expiration_Data" class="form-label">Fecha de Expiración</label>
                            <input type="date" class="form-control" id="expiration_Data" required>
                        </div>
                        <div class="mb-3">
                            <label for="stock" class="form-label">Stock</label>
                            <input type="number" class="form-control" id="stock" required>
                        </div>
                        <div class="mb-3">
                            <label for="image" class="form-label">Imagen</label>
                            <input type="file" class="form-control" id="image" accept="image/*" required>
                        </div>
                        <div class="mb-3">
                            <label for="tags" class="form-label">Etiquetas</label>
                            <input type="text" class="form-control" id="tags" placeholder="Separar con comas" required>
                        </div>
                        <button type="button" class="btn btn-primary" onclick="createProduct()">Guardar</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Cargar datos de la API
        async function loadProducts() {
            try {
                const response = await fetch('https://backend-c6cn.onrender.com/api/products/all');
                const products = await response.json();
                const tableBody = document.getElementById('productTableBody');

                products.forEach(product => {
                    const row = document.createElement('tr');

                    row.innerHTML = `
                        <td>${product.idproducts}</td>
                        <td>${product.nameproducts}</td>
                        <td>${product.price}</td>
                        <td>${product.discount}</td>
                        <td>${product.provider}</td>
                        <td>${product.stock}</td>
                        <td><img src="${product.image}" alt="Imagen de ${product.nameproducts}" style="width: 50px;"></td>
                        <td>${product.tags}</td>
                    `;

                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error('Error al cargar los productos:', error);
            }
        }

        // Crear producto
        async function createProduct() {
            const formData = new FormData();
            formData.append('nameproducts', document.getElementById('nameproducts').value);
            formData.append('descriptions', document.getElementById('descriptions').value);
            formData.append('price', parseFloat(document.getElementById('price').value));
            formData.append('discount', parseFloat(document.getElementById('discount').value) || 0);
            formData.append('provider', document.getElementById('provider').value);
            formData.append('expiration_Data', document.getElementById('expiration_Data').value);
            formData.append('stock', parseInt(document.getElementById('stock').value, 10));
            formData.append('image', document.getElementById('image').files[0]);
            formData.append('tags', document.getElementById('tags').value);

            try {
                const response = await fetch('https://backend-c6cn.onrender.com/api/products', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    alert('Producto creado exitosamente');
                    loadProducts(); // Recargar productos
                    document.getElementById('createProductForm').reset(); // Limpiar formulario
                    const modal = bootstrap.Modal.getInstance(document.getElementById('createProductModal'));
                    modal.hide();
                } else {
                    alert('Error al crear el producto');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error al crear el producto');
            }
        }

        // Cargar productos al inicio
        loadProducts();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
